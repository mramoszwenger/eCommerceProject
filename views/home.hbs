<h1>{{title}}</h1>

<section>
    <h2>Productos Destacados</h2>
    <div id="featured-products" class="featured-products">
        {{#each featuredProducts}}
            <div class="product-card" data-id="{{this.id}}">
                {{#if this.image}}
                    <img src="/uploads/products/{{this.image}}" alt="{{this.title}}">
                {{else}}
                    <img src="/uploads/products/default-product.jpg" alt="Imagen no disponible">
                {{/if}}
                <h3>{{this.title}}</h3>
                <p>${{this.price}}</p>
                <a href="/products/{{this.id}}" class="btn">Ver Detalles</a>
            </div>
        {{/each}}
    </div>
</section>

<section>
    <h2>Sobre Nosotros</h2>
    <p>Somos tu tienda en línea de confianza, ofreciendo los mejores productos al mejor precio.</p>
</section>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();

    socket.on('productAdded', (newProduct) => {
        const featuredProducts = document.getElementById('featured-products');
        const productCards = featuredProducts.getElementsByClassName('product-card');

        // Crear el nuevo elemento de producto
        const newProductElement = document.createElement('div');
        newProductElement.className = 'product-card';
        newProductElement.setAttribute('data-id', newProduct._id);
        newProductElement.innerHTML = `
            <img src="/uploads/products/${newProduct.image || 'default-product.jpg'}" alt="${newProduct.title}">
            <h3>${newProduct.title}</h3>
            <p>$${newProduct.price}</p>
            <a href="/products/${newProduct._id}" class="btn">Ver Detalles</a>
        `;

        // Insertar el nuevo producto al principio
        featuredProducts.insertBefore(newProductElement, productCards[0]);

        // Si hay más de 4 productos, eliminar el último
        if (productCards.length > 4) {
            featuredProducts.removeChild(productCards[productCards.length - 1]);
        }
    });

    socket.on('productUpdated', (updatedProduct) => {
        const productElement = document.querySelector(`.product-card[data-id="${updatedProduct._id}"]`);
        if (productElement) {
            productElement.innerHTML = `
                <img src="/uploads/products/${updatedProduct.image || 'default-product.jpg'}" alt="${updatedProduct.title}">
                <h3>${updatedProduct.title}</h3>
                <p>$${updatedProduct.price}</p>
                <a href="/products/${updatedProduct._id}" class="btn">Ver Detalles</a>
            `;
        }
    });

    socket.on('productDeleted', (productId) => {
        const productElement = document.querySelector(`.product-card[data-id="${productId}"]`);
        if (productElement) {
            productElement.remove();
        }
    });
</script>
